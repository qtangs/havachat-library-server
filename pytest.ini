[pytest]
# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test directories
testpaths = tests

# Markers for selective test execution
markers =
    unit: Unit tests for individual functions/classes (fast, mocked)
    contract: Contract tests validating JSON schema compliance
    integration: Integration tests with real/stubbed LLM calls (slow)
    quality_gate: Quality gate validation tests (schema, duplication, links)
    slow: Tests that take >5 seconds to run
    requires_api_key: Tests requiring OPENAI_API_KEY or ANTHROPIC_API_KEY
    requires_knowledge_repo: Tests requiring havachat-knowledge repository access

# Output and logging
addopts = 
    --verbose
    --strict-markers
    --tb=short
    --capture=no
    -ra
    --color=yes

# Coverage (optional, enable when coverage tracking is needed)
# addopts = --cov=src/pipeline --cov-report=term-missing --cov-report=html

# Ignore directories
norecursedirs = .git .venv venv node_modules dist build __pycache__ .pytest_cache

# Environment variables for tests (override in .env or command line)
env =
    PYTHONPATH=src
