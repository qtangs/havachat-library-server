{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://havachat.com/schemas/content_unit.json",
  "title": "Content Unit",
  "description": "Conversation or story containing multiple segments with learning item links",
  "type": "object",
  "required": [
    "id",
    "language",
    "type",
    "title",
    "description",
    "text",
    "segments",
    "learning_item_ids",
    "level_system",
    "level_min",
    "level_max",
    "word_count",
    "estimated_reading_time_seconds",
    "has_audio",
    "has_questions",
    "publishable",
    "created_at",
    "version"
  ],
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid"
    },
    "language": {
      "type": "string",
      "enum": ["zh", "ja", "fr", "en", "es"]
    },
    "type": {
      "type": "string",
      "enum": ["conversation", "story"]
    },
    "title": {
      "type": "string",
      "minLength": 3,
      "maxLength": 100
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500
    },
    "text": {
      "type": "string",
      "minLength": 50,
      "description": "Full text (concatenated segments)"
    },
    "segments": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["segment_id", "type", "text", "learning_item_ids"],
        "properties": {
          "segment_id": {
            "type": "string"
          },
          "type": {
            "type": "string",
            "enum": ["dialogue", "narration", "question"]
          },
          "speaker": {
            "type": "string"
          },
          "text": {
            "type": "string",
            "minLength": 1
          },
          "translation": {
            "type": "string"
          },
          "learning_item_ids": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uuid"
            }
          },
          "start_time_ms": {
            "type": "integer",
            "minimum": 0
          },
          "end_time_ms": {
            "type": "integer",
            "minimum": 0
          }
        },
        "additionalProperties": false
      }
    },
    "learning_item_ids": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uuid"
      },
      "description": "All learning items featured (deduplicated)"
    },
    "topic_ids": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "scenario_ids": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "level_system": {
      "type": "string",
      "enum": ["cefr", "hsk", "jlpt"]
    },
    "level_min": {
      "type": "string"
    },
    "level_max": {
      "type": "string"
    },
    "word_count": {
      "type": "integer",
      "minimum": 1
    },
    "estimated_reading_time_seconds": {
      "type": "integer",
      "minimum": 1
    },
    "has_audio": {
      "type": "boolean"
    },
    "has_questions": {
      "type": "boolean"
    },
    "publishable": {
      "type": "boolean"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "id": "650e8400-e29b-41d4-a716-446655440000",
      "language": "fr",
      "type": "conversation",
      "title": "Greeting Someone New",
      "description": "A1 level conversation about meeting someone for the first time",
      "text": "Alice: Bonjour! Je m'appelle Alice. Bob: Enchanté, Alice. Je suis Bob.",
      "segments": [
        {
          "segment_id": "seg-1",
          "type": "dialogue",
          "speaker": "Alice",
          "text": "Bonjour! Je m'appelle Alice.",
          "translation": "Hello! My name is Alice.",
          "learning_item_ids": ["550e8400-e29b-41d4-a716-446655440001", "550e8400-e29b-41d4-a716-446655440002"]
        },
        {
          "segment_id": "seg-2",
          "type": "dialogue",
          "speaker": "Bob",
          "text": "Enchanté, Alice. Je suis Bob.",
          "translation": "Nice to meet you, Alice. I am Bob.",
          "learning_item_ids": ["550e8400-e29b-41d4-a716-446655440003", "550e8400-e29b-41d4-a716-446655440002"]
        }
      ],
      "learning_item_ids": ["550e8400-e29b-41d4-a716-446655440001", "550e8400-e29b-41d4-a716-446655440002", "550e8400-e29b-41d4-a716-446655440003"],
      "topic_ids": ["social-interaction"],
      "scenario_ids": ["meeting-someone-new"],
      "level_system": "cefr",
      "level_min": "A1",
      "level_max": "A1",
      "word_count": 12,
      "estimated_reading_time_seconds": 30,
      "has_audio": false,
      "has_questions": false,
      "publishable": false,
      "created_at": "2026-01-26T12:00:00Z",
      "version": "1.0.0"
    }
  ]
}
